import{H as ut,g as pt,d as gt,e as mt,w as X,n as j}from"./index-D2PvbXKv.js";import{f as Fe,l as Ie}from"./index-D2PvbXKv.js";import{t as E,s as ft,y as xt,i as yt}from"./app-X8mMP629.js";import{o as q}from"./ordinal-Cboi1Yqb.js";import{c as kt}from"./colors-Cc3OSVma.js";import{s as vt}from"./array-DEnAxiAM.js";import{w as bt,c as K}from"./path-CbwjOpE9.js";import{b as wt}from"./bump-ClWOOmqL.js";import{x as zt,y as Et}from"./point-DWREGWZc.js";import{m as U,a as Y}from"./min-tv6RD-6E.js";import"./init-Gi6I4Gst.js";function Ct(e,t){let r,i=-1,a=-1;if(t===void 0)for(const o of e)++a,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,i=a);else for(let o of e)(o=t(o,++a,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,i=a);return i}const St=kt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Xt(e){return e.source}function jt(e){return e.target}function Rt(e){let t=Xt,r=jt,i=zt,a=Et,o=null,l=null,s=bt(h);function h(){let d;const c=vt.call(arguments),p=t.apply(this,c),g=r.apply(this,c);if(o==null&&(l=e(d=s())),l.lineStart(),c[0]=p,l.point(+i.apply(this,c),+a.apply(this,c)),c[0]=g,l.point(+i.apply(this,c),+a.apply(this,c)),l.lineEnd(),d)return l=null,d+""||null}return h.source=function(d){return arguments.length?(t=d,h):t},h.target=function(d){return arguments.length?(r=d,h):r},h.x=function(d){return arguments.length?(i=typeof d=="function"?d:K(+d),h):i},h.y=function(d){return arguments.length?(a=typeof d=="function"?d:K(+d),h):a},h.context=function(d){return arguments.length?(d==null?o=l=null:l=e(o=d),h):o},h}function At(){return Rt(wt)}const G=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),$t=q(St),J=(e=1,t=3,r=2)=>i=>e+t/r**i.state.depth,Q={autoFit:!1,duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,scrollForPan:G,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1,color:e=>{var t;return $t(`${((t=e.state)==null?void 0:t.path)||""}`)},lineWidth:J(),maxWidth:0,nodeMinHeight:16,paddingX:8,spacingHorizontal:80,spacingVertical:5};function Me(e){const t={},r={...e},{color:i,colorFreezeLevel:a,lineWidth:o}=r;if((i==null?void 0:i.length)===1){const l=i[0];t.color=()=>l}else if(i!=null&&i.length){const l=q(i);t.color=s=>l(`${s.state.path}`)}if(a){const l=t.color||Q.color;t.color=s=>(s={...s,state:{...s.state,path:s.state.path.split(".").slice(0,a).join(".")}},l(s))}if(o){const l=Array.isArray(o)?o:[o,0,1];t.lineWidth=J(...l)}return["duration","fitRatio","initialExpandLevel","maxInitialScale","maxWidth","nodeMinHeight","paddingX","spacingHorizontal","spacingVertical"].forEach(l=>{const s=r[l];typeof s=="number"&&(t[l]=s)}),["zoom","pan"].forEach(l=>{const s=r[l];s!=null&&(t[l]=!!s)}),t}function Bt(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return(t>>>0).toString(36)}function k(e){if(typeof e=="string"){const r=e;e=i=>i.matches(r)}const t=e;return function(){let r=Array.from(this.childNodes);return t&&(r=r.filter(i=>t(i))),r}}function Ot(e){var t=0,r=e.children,i=r&&r.length;if(!i)t=1;else for(;--i>=0;)t+=r[i].value;e.value=t}function Dt(){return this.eachAfter(Ot)}function Mt(e){var t=this,r,i=[t],a,o,l;do for(r=i.reverse(),i=[];t=r.pop();)if(e(t),a=t.children,a)for(o=0,l=a.length;o<l;++o)i.push(a[o]);while(i.length);return this}function Ht(e){for(var t=this,r=[t],i,a;t=r.pop();)if(e(t),i=t.children,i)for(a=i.length-1;a>=0;--a)r.push(i[a]);return this}function Lt(e){for(var t=this,r=[t],i=[],a,o,l;t=r.pop();)if(i.push(t),a=t.children,a)for(o=0,l=a.length;o<l;++o)r.push(a[o]);for(;t=i.pop();)e(t);return this}function Wt(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,i=t.children,a=i&&i.length;--a>=0;)r+=i[a].value;t.value=r})}function Ft(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function It(e){for(var t=this,r=Tt(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var a=i.length;e!==r;)i.splice(a,0,e),e=e.parent;return i}function Tt(e,t){if(e===t)return e;var r=e.ancestors(),i=t.ancestors(),a=null;for(e=r.pop(),t=i.pop();e===t;)a=e,e=r.pop(),t=i.pop();return a}function Pt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Nt(){var e=[];return this.each(function(t){e.push(t)}),e}function _t(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Vt(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function M(e,t){var r=new R(e),i=+e.value&&(r.value=e.value),a,o=[r],l,s,h,d;for(t==null&&(t=Ut);a=o.pop();)if(i&&(a.value=+a.data.value),(s=t(a.data))&&(d=s.length))for(a.children=new Array(d),h=d-1;h>=0;--h)o.push(l=a.children[h]=new R(s[h])),l.parent=a,l.depth=a.depth+1;return r.eachBefore(Zt)}function Kt(){return M(this).eachBefore(Yt)}function Ut(e){return e.children}function Yt(e){e.data=e.data.data}function Zt(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function R(e){this.data=e,this.depth=this.height=0,this.parent=null}R.prototype=M.prototype={constructor:R,count:Dt,each:Mt,eachAfter:Lt,eachBefore:Ht,sum:Wt,sort:Ft,path:It,ancestors:Pt,descendants:Nt,leaves:_t,links:Vt,copy:Kt};const qt="d3-flextree",Gt="2.1.2",Jt="build/d3-flextree.js",Qt="index",te={name:"Chris Maloney",url:"http://chrismaloney.org"},ee="Flexible tree layout algorithm that allows for variable node sizes.",re=["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],ne="https://github.com/klortho/d3-flextree",ie="WTFPL",ae={type:"git",url:"https://github.com/klortho/d3-flextree.git"},se={clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},oe={"d3-hierarchy":"^1.1.5"},le={"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"},he={name:qt,version:Gt,main:Jt,module:Qt,"jsnext:main":"index",author:te,description:ee,keywords:re,homepage:ne,license:ie,repository:ae,scripts:se,dependencies:oe,devDependencies:le},{version:ce}=he,de=Object.freeze({children:e=>e.children,nodeSize:e=>e.data.size,spacing:0});function et(e){const t=Object.assign({},de,e);function r(s){const h=t[s];return typeof h=="function"?h:()=>h}function i(s){const h=l(o(),s,d=>d.children);return h.update(),h.data}function a(){const s=r("nodeSize"),h=r("spacing");return class tt extends M.prototype.constructor{constructor(c){super(c)}copy(){const c=l(this.constructor,this,p=>p.children);return c.each(p=>p.data=p.data.data),c}get size(){return s(this)}spacing(c){return h(this,c)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const c=this.ancestors();return c[c.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((c,p)=>tt.maxExtents(c,p.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(c,p){return{top:Math.min(c.top,p.top),bottom:Math.max(c.bottom,p.bottom),left:Math.min(c.left,p.left),right:Math.max(c.right,p.right)}}}}function o(){const s=a(),h=r("nodeSize"),d=r("spacing");return class extends s{constructor(c){super(c),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return h(this.data)}spacing(c){return d(this.data,c.data)}get x(){return this.data.x}set x(c){this.data.x=c}get y(){return this.data.y}set y(c){this.data.y=c}update(){return rt(this),nt(this),this}}}function l(s,h,d){const c=(p,g)=>{const m=new s(p);Object.assign(m,{parent:g,depth:g===null?0:g.depth+1,height:0,length:1});const x=d(p)||[];return m.children=x.length===0?null:x.map(y=>c(y,m)),m.children&&Object.assign(m,m.children.reduce((y,v)=>({height:Math.max(y.height,v.height+1),length:y.length+v.length}),m)),m};return c(h,null)}return Object.assign(i,{nodeSize(s){return arguments.length?(t.nodeSize=s,i):t.nodeSize},spacing(s){return arguments.length?(t.spacing=s,i):t.spacing},children(s){return arguments.length?(t.children=s,i):t.children},hierarchy(s,h){const d=typeof h>"u"?t.children:h;return l(a(),s,d)},dump(s){const h=r("nodeSize"),d=c=>p=>{const g=c+"  ",m=c+"    ",{x,y}=p,v=h(p),b=p.children||[],z=b.length===0?" ":`,${g}children: [${m}${b.map(d(m)).join(m)}${g}],${c}`;return`{ size: [${v.join(", ")}],${g}x: ${x}, y: ${y}${z}},`};return d(`
`)(s)}}),i}et.version=ce;const rt=(e,t=0)=>(e.y=t,(e.children||[]).reduce((r,i)=>{const[a,o]=r;rt(i,e.y+e.ySize);const l=(a===0?i.lExt:i.rExt).bottom;a!==0&&pe(e,a,o);const s=be(l,a,o);return[a+1,s]},[0,null]),ue(e),ve(e),e),nt=(e,t,r)=>{typeof t>"u"&&(t=-e.relX-e.prelim,r=0);const i=t+e.relX;return e.relX=i+e.prelim-r,e.prelim=0,e.x=r+e.relX,(e.children||[]).forEach(a=>nt(a,i,e.x)),e},ue=e=>{(e.children||[]).reduce((t,r)=>{const[i,a]=t,o=i+r.shift,l=a+o+r.change;return r.relX+=l,[o,l]},[0,0])},pe=(e,t,r)=>{const i=e.children[t-1],a=e.children[t];let o=i,l=i.relX,s=a,h=a.relX,d=!0;for(;o&&s;){o.bottom>r.lowY&&(r=r.next);const c=l+o.prelim-(h+s.prelim)+o.xSize/2+s.xSize/2+o.spacing(s);(c>0||c<0&&d)&&(h+=c,ge(a,c),me(e,t,r.index,c)),d=!1;const p=o.bottom,g=s.bottom;p<=g&&(o=xe(o),o&&(l+=o.relX)),p>=g&&(s=fe(s),s&&(h+=s.relX))}!o&&s?ye(e,t,s,h):o&&!s&&ke(e,t,o,l)},ge=(e,t)=>{e.relX+=t,e.lExtRelX+=t,e.rExtRelX+=t},me=(e,t,r,i)=>{const a=e.children[t],o=t-r;if(o>1){const l=i/o;e.children[r+1].shift+=l,a.shift-=l,a.change-=i-l}},fe=e=>e.hasChildren?e.firstChild:e.lThr,xe=e=>e.hasChildren?e.lastChild:e.rThr,ye=(e,t,r,i)=>{const a=e.firstChild,o=a.lExt,l=e.children[t];o.lThr=r;const s=i-r.relX-a.lExtRelX;o.relX+=s,o.prelim-=s,a.lExt=l.lExt,a.lExtRelX=l.lExtRelX},ke=(e,t,r,i)=>{const a=e.children[t],o=a.rExt,l=e.children[t-1];o.rThr=r;const s=i-r.relX-a.rExtRelX;o.relX+=s,o.prelim-=s,a.rExt=l.rExt,a.rExtRelX=l.rExtRelX},ve=e=>{if(e.hasChildren){const t=e.firstChild,r=e.lastChild,i=(t.prelim+t.relX-t.xSize/2+r.relX+r.prelim+r.xSize/2)/2;Object.assign(e,{prelim:i,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:r.rExt,rExtRelX:r.rExtRelX})}},be=(e,t,r)=>{for(;r!==null&&e>=r.lowY;)r=r.next;return{lowY:e,index:t,next:r}},it=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",He=it,B="g.markmap-node",we="path.markmap-link",ze="g.markmap-highlight",O=At();function Z(e,t){const r=Ct(e,t);return e[r]}function D(e){e.stopPropagation()}const Ee=new ut;class at{constructor(t,r){this.options={...Q},this._disposeList=[],this.handleZoom=i=>{const{transform:a}=i;this.g.attr("transform",a)},this.handlePan=i=>{i.preventDefault();const a=E(this.svg.node()),o=a.translate(-i.deltaX/a.k,-i.deltaY/a.k);this.svg.call(this.zoom.transform,o)},this.handleClick=(i,a)=>{let o=this.options.toggleRecursively;(G?i.metaKey:i.ctrlKey)&&(o=!o),this.toggleNode(a,o)},this.ensureView=this.ensureVisible,this.svg=t.datum?t:ft(t),this.styleNode=this.svg.append("style"),this.zoom=xt().filter(i=>this.options.scrollForPan&&i.type==="wheel"?i.ctrlKey&&!i.button:(!i.ctrlKey||i.type==="wheel")&&!i.button).on("zoom",this.handleZoom),this.setOptions(r),this.state={id:this.options.id||this.svg.attr("id")||pt(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(gt(()=>{this.renderData()},100)),this._disposeList.push(Ee.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:t}=this.options,{id:r}=this.state,i=typeof t=="function"?t(r):"";return[this.options.embedGlobalCSS&&it,i].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",mt(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}async toggleNode(t,r=!1){var i,a;const o=(i=t.payload)!=null&&i.fold?0:1;r?X(t,(l,s)=>{l.payload={...l.payload,fold:o},s()}):t.payload={...t.payload,fold:(a=t.payload)!=null&&a.fold?0:1},await this.renderData(t)}_initializeData(t){let r=0;const{color:i,initialExpandLevel:a}=this.options;let o=0,l=0;return X(t,(s,h,d)=>{var c,p,g,m;l+=1,s.children=(c=s.children)==null?void 0:c.map(y=>({...y})),r+=1,s.state={...s.state,depth:l,id:r,rect:{x:0,y:0,width:0,height:0},size:[0,0]},s.state.key=[(p=d==null?void 0:d.state)==null?void 0:p.id,s.state.id].filter(Boolean).join(".")+Bt(s.content),s.state.path=[(g=d==null?void 0:d.state)==null?void 0:g.path,s.state.id].filter(Boolean).join("."),i(s);const x=((m=s.payload)==null?void 0:m.fold)===2;x?o+=1:(o||a>=0&&s.state.depth>=a)&&(s.payload={...s.payload,fold:1}),h(),x&&(o-=1),l-=1}),t}_relayout(){if(!this.state.data)return;this.g.selectAll(k(B)).selectAll(k("foreignObject")).each(function(h){var d;const c=(d=this.firstChild)==null?void 0:d.firstChild,p=[c.scrollWidth,c.scrollHeight];h.state.size=p});const{lineWidth:t,paddingX:r,spacingHorizontal:i,spacingVertical:a}=this.options,o=et({}).children(h=>{var d;if(!((d=h.payload)!=null&&d.fold))return h.children}).nodeSize(h=>{const[d,c]=h.data.state.size;return[c,d+(d?r*2:0)+i]}).spacing((h,d)=>(h.parent===d.parent?a:a*2)+t(h.data)),l=o.hierarchy(this.state.data);o(l);const s=l.descendants();s.forEach(h=>{const d=h.data;d.state.rect={x:h.y,y:h.x-h.xSize/2,width:h.ySize-i,height:h.xSize}}),this.state.rect={x1:U(s,h=>h.data.state.rect.x)||0,y1:U(s,h=>h.data.state.rect.y)||0,x2:Y(s,h=>h.data.state.rect.x+h.data.state.rect.width)||0,y2:Y(s,h=>h.data.state.rect.y+h.data.state.rect.height)||0}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(t,r){r&&this.setOptions(r),t&&(this.state.data=this._initializeData(t)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(t){this.state.highlight=t||void 0,await this.renderData()}_getHighlightRect(t){const r=this.svg.node(),i=4/E(r).k,a={...t.state.rect};return a.x-=i,a.y-=i,a.width+=2*i,a.height+=2*i,a}async renderData(t){const{paddingX:r,autoFit:i,color:a,maxWidth:o,lineWidth:l}=this.options,s=this.state.data;if(!s)return;const h={},d={},c=[];X(s,(n,u,f)=>{var w;(w=n.payload)!=null&&w.fold||u(),h[n.state.id]=n,f&&(d[n.state.id]=f.state.id),c.push(n)});const p={},g={},m=n=>{!n||p[n.state.id]||X(n,(u,f)=>{p[u.state.id]=n.state.id,f()})},x=n=>g[p[n.state.id]]||s.state.rect,y=n=>(h[p[n.state.id]]||s).state.rect;g[s.state.id]=s.state.rect,t&&m(t);const{highlight:v}=this.state;let b=this.g.selectAll(k(ze)).selectAll(k("rect")).data(v?[this._getHighlightRect(v)]:[]).join("rect").attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height);const z=this.g.selectAll(k(B)).each(n=>{g[n.state.id]=n.state.rect}).data(c,n=>n.state.key),H=z.enter().append("g").attr("data-depth",n=>n.state.depth).attr("data-path",n=>n.state.path).each(n=>{m(h[d[n.state.id]])}),C=z.exit().each(n=>{m(h[d[n.state.id]])}),S=z.merge(H).attr("class",n=>{var u;return["markmap-node",((u=n.payload)==null?void 0:u.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),L=S.selectAll(k("line")).data(n=>[n],n=>n.state.key),W=L.enter().append("line").attr("stroke",n=>a(n)).attr("stroke-width",0),F=L.merge(W),I=S.selectAll(k("circle")).data(n=>{var u;return(u=n.children)!=null&&u.length?[n]:[]},n=>n.state.key),T=I.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(n,u)=>this.handleClick(n,u)).on("mousedown",D).merge(I).attr("stroke",n=>a(n)).attr("fill",n=>{var u;return(u=n.payload)!=null&&u.fold&&n.children?a(n):"var(--markmap-circle-open-bg)"}),P=this._observer,N=S.selectAll(k("foreignObject")).data(n=>[n],n=>n.state.key),A=N.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",r).attr("y",0).style("opacity",0).on("mousedown",D).on("dblclick",D);A.append("xhtml:div").append("xhtml:div").html(n=>n.content).attr("xmlns","http://www.w3.org/1999/xhtml"),A.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.observe(u)});const _=C.selectAll(k("foreignObject"));_.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.unobserve(u)});const V=A.merge(N),st=c.flatMap(n=>{var u;return(u=n.payload)!=null&&u.fold?[]:n.children.map(f=>({source:n,target:f}))}),$=this.g.selectAll(k(we)).data(st,n=>n.target.state.key),ot=$.exit(),lt=$.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",n=>n.target.state.depth).attr("data-path",n=>n.target.state.path).attr("d",n=>{const u=x(n.target),f=[u.x+u.width,u.y+u.height];return O({source:f,target:f})}).attr("stroke-width",0).merge($);this.svg.style("--markmap-max-width",o?`${o}px`:null),await new Promise(requestAnimationFrame),this._relayout(),b=b.data(v?[this._getHighlightRect(v)]:[]).join("rect"),this.transition(b).attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height),H.attr("transform",n=>{const u=x(n);return`translate(${u.x+u.width-n.state.rect.width},${u.y+u.height-n.state.rect.height})`}),this.transition(C).attr("transform",n=>{const u=y(n),f=u.x+u.width-n.state.rect.width,w=u.y+u.height-n.state.rect.height;return`translate(${f},${w})`}).remove(),this.transition(S).attr("transform",n=>`translate(${n.state.rect.x},${n.state.rect.y})`);const ht=C.selectAll(k("line"));this.transition(ht).attr("x1",n=>n.state.rect.width).attr("stroke-width",0),W.attr("x1",n=>n.state.rect.width).attr("x2",n=>n.state.rect.width),F.attr("y1",n=>n.state.rect.height+l(n)/2).attr("y2",n=>n.state.rect.height+l(n)/2),this.transition(F).attr("x1",-1).attr("x2",n=>n.state.rect.width+2).attr("stroke",n=>a(n)).attr("stroke-width",l);const ct=C.selectAll(k("circle"));this.transition(ct).attr("r",0).attr("stroke-width",0),T.attr("cx",n=>n.state.rect.width).attr("cy",n=>n.state.rect.height+l(n)/2),this.transition(T).attr("r",6).attr("stroke-width","1.5"),this.transition(_).style("opacity",0),V.attr("width",n=>Math.max(0,n.state.rect.width-r*2)).attr("height",n=>n.state.rect.height),this.transition(V).style("opacity",1),this.transition(ot).attr("d",n=>{const u=y(n.target),f=[u.x+u.width,u.y+u.height+l(n.target)/2];return O({source:f,target:f})}).attr("stroke-width",0).remove(),this.transition(lt).attr("stroke",n=>a(n.target)).attr("stroke-width",n=>l(n.target)).attr("d",n=>{const u=n.source,f=n.target,w=[u.state.rect.x+u.state.rect.width,u.state.rect.y+u.state.rect.height+l(u)/2],dt=[f.state.rect.x,f.state.rect.y+f.state.rect.height+l(f)/2];return O({source:w,target:dt})}),i&&this.fit()}transition(t){const{duration:r}=this.options;return t.transition().duration(r)}async fit(t=this.options.maxInitialScale){const r=this.svg.node(),{width:i,height:a}=r.getBoundingClientRect(),{fitRatio:o}=this.options,{x1:l,y1:s,x2:h,y2:d}=this.state.rect,c=h-l,p=d-s,g=Math.min(i/c*o,a/p*o,t),m=yt.translate((i-c*g)/2-l*g,(a-p*g)/2-s*g).scale(g);return this.transition(this.svg).call(this.zoom.transform,m).end().catch(j)}findElement(t){let r;return this.g.selectAll(k(B)).each(function(i){i===t&&(r={data:i,g:this})}),r}async ensureVisible(t,r){var i;const a=(i=this.findElement(t))==null?void 0:i.data;if(!a)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=E(o),[h,d]=[a.state.rect.x,a.state.rect.x+a.state.rect.width+2].map(b=>b*s.k+s.x),[c,p]=[a.state.rect.y,a.state.rect.y+a.state.rect.height].map(b=>b*s.k+s.y),g={left:0,right:0,top:0,bottom:0,...r},m=[g.left-h,l.width-g.right-d],x=[g.top-c,l.height-g.bottom-p],y=m[0]*m[1]>0?Z(m,Math.abs)/s.k:0,v=x[0]*x[1]>0?Z(x,Math.abs)/s.k:0;if(y||v){const b=s.translate(y,v);return this.transition(this.svg).call(this.zoom.transform,b).end().catch(j)}}async centerNode(t,r){var i;const a=(i=this.findElement(t))==null?void 0:i.data;if(!a)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=E(o),h=(a.state.rect.x+a.state.rect.width/2)*s.k+s.x,d=(a.state.rect.y+a.state.rect.height/2)*s.k+s.y,c={left:0,right:0,top:0,bottom:0,...r},p=(c.left+l.width-c.right)/2,g=(c.top+l.height-c.bottom)/2,m=(p-h)/s.k,x=(g-d)/s.k;if(m||x){const y=s.translate(m,x);return this.transition(this.svg).call(this.zoom.transform,y).end().catch(j)}}async rescale(t){const r=this.svg.node(),{width:i,height:a}=r.getBoundingClientRect(),o=i/2,l=a/2,s=E(r),h=s.translate((o-s.x)*(1-t)/s.k,(l-s.y)*(1-t)/s.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,h).end().catch(j)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(t=>{t()})}static create(t,r,i=null){const a=new at(t,r);return i&&a.setData(i).then(()=>{a.fit()}),a}}export{at as Markmap,k as childSelector,$t as defaultColorFn,Q as defaultOptions,Me as deriveOptions,He as globalCSS,G as isMacintosh,J as lineWidthFactory,Fe as loadCSS,Ie as loadJS,Ee as refreshHook,Bt as simpleHash};
